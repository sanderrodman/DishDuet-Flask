<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>DishDash</title>
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
</head>

<body class="flex">
    <aside class="flex">
        <header>
            <h1 class="color-2">ðŸ¥™ Dish</h1>
            <h1 class="color-1">Dash ðŸ¥˜</h1>
        </header>
        
        <div class="small-aside">
            <h2 id="slogan">... Recipes in a flash!</h2>
            <div class="top-text">
                <div>
                    <label for="filter-text-val">Search For Recipes *</label>
                    <div id="input-box" onclick="sendFocus()">
                        <img alt="" src="{{ url_for('static', filename='images/mag.png') }}" />
                        <input type="text" placeholder="What's Cooking?" class="mainLoginInput" id="filter-text-val">
                    </div>
                </div>

                <div>
                    <div class="flex" id="unwanted-box">
                        <label for="unwanted">What to Avoid</label>
                        <input type="text" placeholder="mushrooms..." class="mainLoginInput" id="unwanted">
                    </div>
                </div>
            </div>
            <div class="side_by_side">
                <div id="allergen_container">
                    <h3>Allergies</h3>

                    <label class="allergen_container"><input type="checkbox" name="allergy-type"
                            value="nut">Nut</label><br />
                    <label class="allergen_container"><input type="checkbox" name="allergy-type"
                            value="vegetarian">Vegetarian</label><br />
                    <label class="allergen_container"><input type="checkbox" name="allergy-type"
                            value="vegan">Vegan</label><br />
                    <label class="allergen_container"><input type="checkbox" name="allergy-type"
                            value="dairy">Dairy</label><br />
                    <label class="allergen_container"><input type="checkbox" name="allergy-type"
                            value="dairy">Egg</label><br />
                    <label class="allergen_container"><input type="checkbox" name="allergy-type"
                            value="gluten">Gluten</label><br />
                    <label class="allergen_container"><input type="checkbox" name="allergy-type"
                            value="shellfish">Shellfish</label><br />
                </div>
                <div id="time-input" class="time_constraint_container">
                    <h3>Cook Time</h3>
                    <label class="time_constraint_container">Max Minutes:<input id="time" type="number" name="time-type" value="60"></label>
                </div>
            </div>
            <div class="search-box">
                <button id="search" onclick="filterText()">Search</button>
            </div>
        </div>
    </aside>
    <main>
        <div id="answer-box">
        </div>
    </main>

    <script>
        var input = document.getElementById("input-box");
        var input2 = document.getElementById("unwanted-box");
        var input3 = document.getElementById("allergen_container");
        var input4 = document.getElementById("time-input");
        input.addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            filterText();
        }
        });
        input2.addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            filterText();
        }
        });
        input3.addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            filterText();
        }
        });
        input4.addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            filterText();
        }
        });
        


        function star(rating, reviewcount) {
            if (4.8 <= rating) {
                return `<img src="{{ url_for('static', filename='images/star.svg') }}">
                <img src="{{ url_for('static', filename='images/star.svg') }}">
                <img src="{{ url_for('static', filename='images/star.svg') }}">
                <img src="{{ url_for('static', filename='images/star.svg') }}">
                <img src="{{ url_for('static', filename='images/star.svg') }}">`+ `<p>(${reviewcount})</p>`
            }
                
            img = ``
            i = 1

            while (i < rating) {
                img += `<img src="{{ url_for('static', filename='images/star.svg') }}">\n`
                i += 1
            }

            if (i - rating <= 0.5) {
                img += `<img src="{{ url_for('static', filename='images/half.svg') }}">\n`
                i += 1
            }

            while (i <= 5) {
                img += `<img src="{{ url_for('static', filename='images/no.svg') }}">\n`
                i += 1
            }

            return img + `<p>(${reviewcount})</p>`
            }


        function answerBoxTemplate(dishname, rating, reviewcount, img, time, ingredients, subpage, desc, calories) {
            return`
            <div class='result flex'>
                <div>
                    <a href = "https://www.food.com/recipe/${subpage}" target="_blank">
                        <h3 class='recipe-title'>${dishname}</h3>
                    </a>
                    <div class="flex star">
                        ${star(rating, reviewcount)}
                    </div>
                    <div class="flex sub-header" >
                        <p><strong>${time} min</strong></p>
            
                        <p><strong>${calories} calories per serving</strong></p>
                    </div>
                    
                    <ul class="flex ingredients">
                        <li><strong>Ingredients:</strong></li>
                        ${printIngredients(ingredients)}
                    </ul>

                    <p>${desc}</p>
                </div>
                <a href = "https://www.food.com/recipe/${subpage}" target="_blank"><img class="photo" src="${img}" alt="${dishname}"></a>
            </div>`
        }

        // <h3>Most relevant for ${top_words[0][0]}, ${top_words[0][1]}, ${top_words[0][2]}, ${top_words[0][3]}, ${top_words[0][4]}</h3>


        function printIngredients(ingredients) {
            if (ingredients.length == 1) {
                return `<li><strong>${ingredients[0]}</strong></li>`
            }
            else if (ingredients.length != 0) {
                const firstElement = ingredients.shift();
                if (ingredients.length == 1) {
                    return `<li><strong>${firstElement}</strong>, and</li>` + printIngredients(ingredients);
                }
                else {
                    return `<li><strong>${firstElement}</strong>,</li>` + printIngredients(ingredients);
                }
            }
            else {
                return ``;
            }
        }

        function sendFocus() {
            document.getElementById('filter-text-val').focus()
        }


        function filterText() {
            document.body.scrollTop = document.documentElement.scrollTop = 0; // sends screen to top of page
            document.getElementById("answer-box").innerHTML = "";
            console.log(document.getElementById("filter-text-val").value);
            
            var allergies = "";
            var inputElements = document.getElementsByName("allergy-type");
            for (var i=0; i<inputElements.length; ++i) {
                if (inputElements[i].checked) {
                    allergies += inputElements[i].value + " " // collects checked allergies
                }
            }

            var time = 0;
            var inputElements = document.getElementsByName("time-type");
            for (var i=0; i<inputElements.length; ++i) {
                if (inputElements[i].checked) {
                    time = inputElements[i].value; // collects checked time
                }
            }

            time = document.getElementsByName("time-type")[0].value;
            
            var inputElements = document.getElementsByName("allergy-type");

            fetch("/recipes?" + new URLSearchParams({

                dishname: document.getElementById("filter-text-val").value,
                unwanted: document.getElementById("unwanted").value,
                allergies: allergies,
                time: time
        
            }).toString())

            .then((response) => response.json())
            .then((data) => data.forEach(row => {
                let tempDiv = document.createElement("div");
                tempDiv.innerHTML = 
                answerBoxTemplate(row.dishname, row.aggregatedrating, row.reviewcount, row.images, row.time, row.ingredientparts, row.subpage, row.detail, row.calories);
                document.getElementById("answer-box").appendChild(tempDiv);
            }));

        }

    function handle(e){
        if (e.key === "Enter"){
            filterText();
        }

    }

    </script>


</body>

</html>